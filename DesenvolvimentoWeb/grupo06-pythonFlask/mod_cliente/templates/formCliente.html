{% extends "modelo.html" %}

{% block title %} CadCliente {% endblock %}

{% block style %} 
    {{super()}}

    <style>

    </style>
{% endblock %} 

{% block content %} 

<div class="container"> 


    {% if cliente.id_cliente == 0 %}

    <h1>Novo Cliente</h1>
    <form id="addCliente" name="addCliente" method="POST" enctype="multipart/form-data" >
    <hr>
    {% else %}

    <h1>Editar Cliente: {{ cliente.id_cliente }}</h1>
    <form id="editCliente" name="editCliente" method="POST" enctype="multipart/form-data">
    <hr>
    {% endif %}

        <div class="row">
            <div class="col-md-1 mb-2">
                <label for="id_cliente">ID:</label>
                <input readonly value="{{ cliente.id_cliente }}" type="text" name="id_cliente"  id="id_cliente" 
                class="form-control" placeholder="ID"  required>  
            </div>

            <div class="col-md-6 mb-2">
                <label for="nome">Nome:</label>
                <input  value="{{ cliente.nome }}" type="text" name="nome"  id="nome" autofocus  
                class="form-control" placeholder="Insira o nome do cliente" maxlength="100" >           
            </div>
        </div> 
        <br>
        <div class="row">
            <div class="col-md-3 mb-2">
                <label for="cpf">Cpf:</label>
                <input value="{{ cliente.cpf }}" type="text" name="cpf"  id="cpf" 
                class="form-control" placeholder="" maxlength="11" >  
            </div>
        </div> 
        <br>
        <div class="row">
            <div class="col-md-3 mb-2">
                <label for="telefone">Telefone:</label>
                <input value="{{ cliente.telefone }}" type="text" name="telefone"  id="telefone" 
                class="form-control" placeholder="" maxlength="11"  >  
            </div>
        </div>
        <br>
        <div class="row">
            <div class="col-md-3 mb-2">
                <label for="compra_fiado">compra_fiado:</label>
                <input value="{{ cliente.compra_fiado }}" type="text" name="compra_fiado"  id="compra_fiado" 
                class="form-control" placeholder="" maxlength="2"  >  
            </div>
        </div>
        <br>
        <div class="row">
            <div class="col-md-3 mb-2">
                <label for="dia_fiado">dia_fiado:</label>
                <input value="{{ cliente.dia_fiado }}" type="text" name="dia_fiado"  id="dia_fiado" 
                class="form-control" placeholder="" maxlength="8" >  
            </div>
        </div>
        <br>
        <div class="row">
            <div class="col-md-3 mb-2">
                <label for="senha">senha:</label>
                <input value="{{ cliente.senha }}" type="text" name="senha"  id="senha" 
                class="form-control" placeholder="" maxlength="200" >
            </div>
        </div>
        <hr>

        <button type='submit' name='salvaProdutoDB' id='salvaProdutoDB' class="btn btn-dark"><i
            class=""></i>Salvar</a></button>
        
    </form>
</div>

{% endblock %}

{% block js %}
<script>
    $SCRIPT_ROOT = {{request.script_root | tojson | safe}}; // pega a url da barra de endereço

    $('#addCliente').submit(function (e) {
        e.preventDefault(); // parar o envio para poder fazer manualmente
        var form = $('#addCliente')[0]; // captura o form
        var data = new FormData(form); // cria o FormData {Object}

        $.ajax({
            type: "POST",
            enctype: 'multipart/form-data',
            url: "{{url_for('cliente.addCliente')}}",
            data: data,
            processData: false,
            contentType: false,
            cache: false,
            timeout: 600000,

            // manipular o retorno da requisição
            success: function (data) {
                if (!data.erro) {
                    swal({
                            title: "",
                            text: data.mensagem,
                            type: "success",
                            confirmButtonClass: "btn-success",
                            confirmButtonText: "Ok",
                            closeOnConfirm: false,
                            closeOnCancel: false
                        },
                        function (isConfirm) {
                            if (isConfirm) {
                                window.location.replace($SCRIPT_ROOT +
                                    "{{ url_for('cliente.ListaClientes') }}");
                            }
                        });
                } else {
                    swal("", data.mensagem + '\n' + data.mensagem_exception, "error");
                }
            },
            error: function (e) {
                console.log(e);
            }
        })
    })

    // incluir aqui a opção para editar
    $('#editCliente').submit(function (e) {
        e.preventDefault(); // parar o envio para poder fazer manualmente
        var form = $('#editCliente')[0]; // captura o form
        var data = new FormData(form); // cria o FormData {Object}

        $.ajax({
            type: "POST",
            enctype: 'multipart/form-data',
            url: "{{url_for('cliente.editCliente')}}",
            data: data,
            processData: false, // impedir que o jQuery tranforma a "data" em querystring
            contentType: false, // desabilitar o cabeçalho "Content-Type"
            cache: false, // desabilitar o "cache"
            timeout: 600000, // definir um tempo limite (opcional)
            // manipular o retorno da requisição
            success: function (data) {
                if (!data.erro) {
                    swal({
                            title: "",
                            text: data.mensagem,
                            type: "success",
                            confirmButtonClass: "btn-success",
                            confirmButtonText: "Ok",
                            closeOnConfirm: false,
                            closeOnCancel: false
                        },
                        function (isConfirm) {
                            if (isConfirm) {
                                window.location.replace($SCRIPT_ROOT +
                                    "{{ url_for('cliente.ListaClientes') }}");
                            }
                        });
                } else {
                    swal("", data.mensagem + '\n' + data.mensagem_exception, "error");
                    console.log(data.mensagem_exception);
                }
            },
            error: function (e) {
                console.log(e);
            }
        })
    })    
</script>
{% endblock %}